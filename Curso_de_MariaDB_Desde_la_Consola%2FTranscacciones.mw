__NOTOC__
* [[:#Transacciones | Transacciones]]
* [[:#SET autocommit | SET autocommit]]
* [[:#Start Transaction | Start Transaction]]

= Transacciones =

<pre>
MariaDB [Prueba1]> show create table Cursos;
+--------+--------------------------------------------------------------------+
| Table  | Create Table                                                       |
+--------+--------------------------------------------------------------------+
| Cursos | CREATE TABLE `Cursos` (
  `ID` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `Nombre` varchar(50) COLLATE utf8_unicode_ci NOT NULL,
  PRIMARY KEY (`ID`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci |
+--------+--------------------------------------------------------------------+
1 row in set (0.06 sec)

MariaDB [Prueba1]> show create table Usuarios;
+----------+------------------------------------------------------------------+
| Table    | Create Table                                                     |
+----------+------------------------------------------------------------------+
| Usuarios | CREATE TABLE `Usuarios` (
  `ID` smallint(5) unsigned NOT NULL AUTO_INCREMENT,
  `Nombre` varchar(30) COLLATE utf8_unicode_ci NOT NULL,
  `Curso` smallint(5) unsigned DEFAULT NULL,
  PRIMARY KEY (`ID`),
  KEY `Curso` (`Curso`),
  CONSTRAINT `Usuarios_ibfk_1` FOREIGN KEY (`Curso`) REFERENCES `Cursos` (`ID`)
) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci |
+----------+------------------------------------------------------------------+
1 row in set (0.19 sec)

</pre>

== SET autocommit ==

<syntaxhighlight lang="sql" line="GESHI_FANCY_LINE_NUMBERS">

MariaDB [Prueba1]> SET autocommit=0;
Query OK, 0 rows affected (0.00 sec)

MariaDB [Prueba1]> SELECT * from Usuarios;
+----+----------+-------+
| ID | Nombre   | Curso |
+----+----------+-------+
|  1 | Ana      |     2 |
|  2 | Roberto  |     1 |
|  3 | Angel    |     5 |
|  4 | Laura    |     3 |
|  5 | Ricardo  |     4 |
|  6 | Mia      |     2 |
|  7 | Leo      |     4 |
|  8 | Mauricio |  NULL |
+----+----------+-------+
9 rows in set (0.00 sec)

MariaDB [Prueba1]> insert into Usuarios values ( NULL, 'Adrian', 4 );
Query OK, 1 row affected (0.04 sec)

MariaDB [Prueba1]> SELECT * from Usuarios;
+----+----------+-------+
| ID | Nombre   | Curso |
+----+----------+-------+
|  1 | Ana      |     2 |
|  2 | Roberto  |     1 |
|  3 | Angel    |     5 |
|  4 | Laura    |     3 |
|  5 | Ricardo  |     4 |
|  6 | Mia      |     2 |
|  7 | Leo      |     4 |
|  8 | Mauricio |  NULL |
| 11 | Adrian   |     4 |
+----+----------+-------+
9 rows in set (0.00 sec)

MariaDB [Prueba1]> quit
Bye

[rrc@Pwyr ~]$ mysql -u rrc -p
Enter password: 

Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 6
Server version: 10.0.24-MariaDB Mageia MariaDB Server

Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]> use Prueba1;
Database changed

MariaDB [Prueba1]> SELECT * from Usuarios;
+----+----------+-------+
| ID | Nombre   | Curso |
+----+----------+-------+
|  1 | Ana      |     2 |
|  2 | Roberto  |     1 |
|  3 | Angel    |     5 |
|  4 | Laura    |     3 |
|  5 | Ricardo  |     4 |
|  6 | Mia      |     2 |
|  7 | Leo      |     4 |
|  8 | Mauricio |  NULL |
+----+----------+-------+
8 rows in set (0.00 sec)

MariaDB [Prueba1]> SET autocommit=0;
Query OK, 0 rows affected (0.00 sec)

MariaDB [Prueba1]> insert into Usuarios values ( NULL, 'Adrian', 4 );
Query OK, 1 row affected (0.02 sec)

MariaDB [Prueba1]> commit;
Query OK, 0 rows affected (0.10 sec)

MariaDB [Prueba1]> SELECT * from Usuarios;
+----+----------+-------+
| ID | Nombre   | Curso |
+----+----------+-------+
|  1 | Ana      |     2 |
|  2 | Roberto  |     1 |
|  3 | Angel    |     5 |
|  4 | Laura    |     3 |
|  5 | Ricardo  |     4 |
|  6 | Mia      |     2 |
|  7 | Leo      |     4 |
|  8 | Mauricio |  NULL |
| 12 | Adrian   |     4 |
+----+----------+-------+
9 rows in set (0.00 sec)

MariaDB [Prueba1]> quit;
Bye

[rrc@Pwyr ~]$ mysql -u rrc -p
Enter password: 

Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 7
Server version: 10.0.24-MariaDB Mageia MariaDB Server

Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]> use Prueba1;
Database changed

MariaDB [Prueba1]> SELECT * from Usuarios;
+----+----------+-------+
| ID | Nombre   | Curso |
+----+----------+-------+
|  1 | Ana      |     2 |
|  2 | Roberto  |     1 |
|  3 | Angel    |     5 |
|  4 | Laura    |     3 |
|  5 | Ricardo  |     4 |
|  6 | Mia      |     2 |
|  7 | Leo      |     4 |
|  8 | Mauricio |  NULL |
| 12 | Adrian   |     4 |
+----+----------+-------+
9 rows in set (0.00 sec)

+----+----------+-------+
9 rows in set (0.00 sec)

MariaDB [Prueba1]> select * from Cursos;
+----+------------+
| ID | Nombre     |
+----+------------+
|  1 | HTML5      |
|  2 | CSS3       |
|  3 | JavaScript |
|  4 | PHP        |
|  5 | MariaDB    |
|  6 | Python     |
+----+------------+
6 rows in set (0.00 sec)

MariaDB [Prueba1]> MariaDB [Prueba1]> SET autocommit = 0;
Query OK, 0 rows affected (0.00 sec)

MariaDB [Prueba1]> insert into Usuarios values ( NULL, 'Hector', 22 );
ERROR 1452 (23000): Cannot add or update a child row: a foreign key constraint fails (`Prueba1`.`Usuarios`, CONSTRAINT `Usuarios_ibfk_1` FOREIGN KEY (`Curso`) REFERENCES `Cursos` (`ID`))

MariaDB [Prueba1]> insert into Usuarios values ( NULL, 'Hector', 2 );
Query OK, 1 row affected (0.00 sec)

WHOOOOOooooops No Quero CSS3, Quero PHP

MariaDB [Prueba1]> SELECT * from Usuarios;
+----+----------+-------+
| ID | Nombre   | Curso |
+----+----------+-------+
|  1 | Ana      |     2 |
|  2 | Roberto  |     1 |
|  3 | Angel    |     5 |
|  4 | Laura    |     3 |
|  5 | Ricardo  |     4 |
|  6 | Mia      |     2 |
|  7 | Leo      |     4 |
|  8 | Mauricio |  NULL |
| 12 | Adrian   |     4 |
| 14 | Hector   |     2 |
+----+----------+-------+
10 rows in set (0.00 sec)

MariaDB [Prueba1]> rollback;
Query OK, 0 rows affected (0.37 sec)

MariaDB [Prueba1]> SELECT * from Usuarios;
+----+----------+-------+
| ID | Nombre   | Curso |
+----+----------+-------+
|  1 | Ana      |     2 |
|  2 | Roberto  |     1 |
|  3 | Angel    |     5 |
|  4 | Laura    |     3 |
|  5 | Ricardo  |     4 |
|  6 | Mia      |     2 |
|  7 | Leo      |     4 |
|  8 | Mauricio |  NULL |
| 12 | Adrian   |     4 |
+----+----------+-------+
9 rows in set (0.00 sec)

MariaDB [Prueba1]> insert into Usuarios values ( NULL, 'Hector', 4 );
Query OK, 1 row affected (0.00 sec)

MariaDB [Prueba1]> SELECT * from Usuarios;
+----+----------+-------+
| ID | Nombre   | Curso |
+----+----------+-------+
|  1 | Ana      |     2 |
|  2 | Roberto  |     1 |
|  3 | Angel    |     5 |
|  4 | Laura    |     3 |
|  5 | Ricardo  |     4 |
|  6 | Mia      |     2 |
|  7 | Leo      |     4 |
|  8 | Mauricio |  NULL |
| 12 | Adrian   |     4 |
| 15 | Hector   |     4 |
+----+----------+-------+
10 rows in set (0.00 sec)

MariaDB [Prueba1]> commit;
Query OK, 0 rows affected (0.10 sec)

</syntaxhighlight>

== Start Transaction ==

<syntaxhighlight lang="sql" line="GESHI_FANCY_LINE_NUMBERS">

</syntaxhighlight>

== Start Transaction ==

<syntaxhighlight lang="sql" line="GESHI_FANCY_LINE_NUMBERS">

</syntaxhighlight>

== Commit ==

<syntaxhighlight lang="sql" line="GESHI_FANCY_LINE_NUMBERS">

</syntaxhighlight>

== Rollback ==

<syntaxhighlight lang="sql" line="GESHI_FANCY_LINE_NUMBERS">

</syntaxhighlight>

[[Category:MariaDB Desde la Consola]]
[[Category: CursoMatiaDB]]
